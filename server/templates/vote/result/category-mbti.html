{% load static %} {% block content %}
<div class="result-chart-category">
  <div class="result-category-title">카테고리</div>
  <div class="result-category-box">
    <div class="result-category-name" id="mbtiToggle">
      <img
        src="{% static 'img/icon/chevron_up.png'%}"
        style="width: 30px"
        class="chevron"
      />
      MBTI
    </div>
    <div class="result-category-chart" id="mbtiChart">
      <div class="mbti-result">
        <div class="result-EI-chart">
          <div class="small-choice-title">E vs I</div>
          <canvas id="EIChart"></canvas>
          <div>
            <span class="small-choice-title"
              >{{ poll.choice_set.all.0.choice_text }} : </span
            ><span>{{choice1_man_percentage}}%</span>
          </div>
          <div>
            <span class="small-choice-title"
              >{{ poll.choice_set.all.1.choice_text }} : </span
            ><span>{{choice2_man_percentage}}%</span>
          </div>
        </div>
        <!-- <div class="result-woman-chart">
          <div class="small-choice-title">S vs N</div>
          <canvas id="SNChart"></canvas>
          <div>
            <span class="small-choice-title"
              >{{ poll.choice_set.all.0.choice_text }} : </span
            ><span>{{choice1_woman_percentage}}%</span>
          </div>
          <div>
            <span class="small-choice-title"
              >{{ poll.choice_set.all.1.choice_text }} : </span
            ><span>{{choice2_woman_percentage}}%</span>
          </div>
        </div> -->
      </div>
    </div>
  </div>
</div>

<script>
  // var ctx3 = document.getElementById("mbtiChart").getContext("2d");
  // var EIChart = new Chart(ctx3, {
  //   type: "bar",
  //   data: {
  //     labels: ["E vs I", "S vs N"],
  //     datasets: [
  //       {
  //         label: "좋아함",
  //         backgroundColor: "rgba(75, 192, 192, 0.2)",
  //         borderColor: "rgba(75, 192, 192, 1)",
  //         borderWidth: 1,
  //         data: [70, 40],
  //       },
  //       {
  //         label: "싫어함",
  //         backgroundColor: "rgba(255, 99, 132, 0.2)",
  //         borderColor: "rgba(255, 99, 132, 1)",
  //         borderWidth: 1,
  //         data: [30, 60],
  //       },
  //     ],
  //   },
  //   options: {
  //     scales: {
  //       y: {
  //         beginAtZero: true,
  //       },
  //     },
  //   },
  // });

  // var ctx2 = document.getElementById("SNChart").getContext("2d");
  //   var womanChart = new Chart(ctx2, {
  //       type: "pie",
  //       data: {
  //         labels:[ {% for choice in poll.choice_set.all %}
  //       "{{ choice.choice_text }}",
  //         {% endfor %}],
  //         datasets: [{
  //           label: "여성",
  //           backgroundColor: ["rgba(75, 192, 192, 0.2)", "rgba(255, 99, 132, 0.2)"],
  //           borderColor: ["rgba(75, 192, 192, 1)", "rgba(255, 99, 132, 1)"],
  //           borderWidth: 1,
  //           data: [{{choice1_woman_percentage}}, {{choice2_woman_percentage}}]
  //         }]
  //       },
  //       options: {
  //         scales: {
  //           x: {
  //             beginAtZero: true
  //           }
  //         }
  //       }
  //     });
  var barOptions_stacked = {
    tooltips: {
      enabled: false,
    },
    hover: {
      animationDuration: 0,
    },
    scales: {
      xAxes: [
        {
          ticks: {
            beginAtZero: true,
            fontFamily: "'Open Sans Bold', sans-serif",
            fontSize: 11,
          },
          scaleLabel: {
            display: false,
          },
          gridLines: {},
          stacked: true,
        },
      ],
      yAxes: [
        {
          gridLines: {
            display: false,
            color: "#fff",
            zeroLineColor: "#fff",
            zeroLineWidth: 0,
          },
          ticks: {
            fontFamily: "'Open Sans Bold', sans-serif",
            fontSize: 11,
          },
          stacked: true,
        },
      ],
    },
    legend: {
      display: false,
    },

    animation: {
      onComplete: function () {
        var chartInstance = this.chart;
        var ctx = chartInstance.ctx;
        ctx.textAlign = "left";
        ctx.font = "9px Open Sans";
        ctx.fillStyle = "#fff";

        Chart.helpers.each(
          this.data.datasets.forEach(function (dataset, i) {
            var meta = chartInstance.controller.getDatasetMeta(i);
            Chart.helpers.each(
              meta.data.forEach(function (bar, index) {
                data = dataset.data[index];
                if (i == 0) {
                  ctx.fillText(data, 50, bar._model.y + 4);
                } else {
                  ctx.fillText(data, bar._model.x - 25, bar._model.y + 4);
                }
              }),
              this
            );
          }),
          this
        );
      },
    },
    pointLabelFontFamily: "Quadon Extra Bold",
    scaleFontFamily: "Quadon Extra Bold",
  };

  var ctx = document.getElementById("Chart1");
  var myChart = new Chart(ctx, {
    type: "horizontalBar",
    data: {
      labels: ["82", " 81 ", "2", " 42", "4"],

      datasets: [
        {
          data: [727, 589, 537, 543, 20],
          backgroundColor: "#5f8a58",
          hoverBackgroundColor: "rgba(50,90,100,1)",
        },
        {
          data: [238, 553, 746, 884, 122],
          backgroundColor: "#3f7faa",
          hoverBackgroundColor: "rgba(140,85,100,1)",
        },
        {
          data: [100, 100, 100, 100, 100],
          backgroundColor: "#000",
          hoverBackgroundColor: "rgba(140,85,100,1)",
        },
      ],
    },

    options: barOptions_stacked,
  });
</script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const toggleTriggers = document.querySelectorAll(".toggle-trigger");

    toggleTriggers.forEach((trigger) => {
      trigger.addEventListener("click", function () {
        const targetId = this.getAttribute("data-target");
        const target = document.getElementById(targetId);
        const chevron = this.querySelector(".chevron");

        if (target.style.display === "none" || target.style.display === "") {
          target.style.display = "block";
          chevron.style.transform = "rotate(180deg)";
        } else {
          target.style.display = "none";
          chevron.style.transform = "none";
        }
      });
    });
  });
</script>
<style>
  .chevron {
    width: 30px;
    transition: transform 0.3s ease;
  }
  .rotate {
    transform: rotate(180deg);
  }
</style>

{% endblock %}
