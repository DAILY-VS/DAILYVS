{% extends 'vote/base.html' %} {% load static %} {% block content %}

<div class="vote-detail-container">
  <div class="detail-top">
    <a href="{% url 'vote:main' %}" role="button" class="back-button"
      ><img src="{% static 'img/icon/left_page.png'%}" style="width: 30px" />
      이전 페이지로

    </a>
    <div class="detail-views">
      <span
        ><img src="{% static 'img/icon/view.png'%}" style="width: 20px"
      /></span>
      <span> {{ poll.views_count }} </span>
      <span> views</span>
    </div>
  </div>
  <div class="detail2-title">당신의 MBTI는 ?</div>
  <div class="option-container">
    <form id="loginmodal" action="{% url 'vote:nonuserfinal' poll.id nonuservote_id %}" method="POST">
      {% csrf_token %}
      <div>
        <label><input type="radio" name="choice_EI" value="E" /> E</label>
        <label><input type="radio" name="choice_EI" value="I" /> I</label>
      </div>
      <div>
        <label><input type="radio" name="choice_SN" value="S" /> S</label>
        <label><input type="radio" name="choice_SN" value="N" /> N</label>
      </div>
      <div>
        <label><input type="radio" name="choice_FT" value="F" /> F</label>
        <label><input type="radio" name="choice_FT" value="T" /> T</label>
      </div>
      <div>
        <label><input type="radio" name="choice_JP" value="J" /> J</label>
        <label><input type="radio" name="choice_JP" value="P" /> P</label>
      </div>
      <input type="hidden" id="selected-mbti-input" name="selected_mbti" value="" />
      <input type="button" data-bs-toggle="modal" href="#exampleModal" value="등록하기" class="vote-submit-btn" disabled />
    </form>
  </div>
    <div> 내가 선택한 mbti 조합 : <span id="selected-mbti"></span></div>
</div>

<div class="modal fade" id="exampleModal">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <p> 로그인을 하시면 더 많은 기능을 사용하실 수 있어요!</p>
        <div class="modal-footer">
          <a href="{% url 'account:login' %}"> 로그인하러가기 </a>
          <button type="button" class="btn btn-primary" id="submitForm">그냥 투표하기</button>
        </div>
      </div>
    </div>
  </div>
</div>
  
<script>
  // 진행 버튼 클릭 시 폼 제출
  document.getElementById("submitForm").addEventListener("click", function () {
      console.log('33')
      document.getElementById("loginmodal").submit();
  });
</script>

<script>
    document.addEventListener("DOMContentLoaded", function () {
      const radioGroups = document.querySelectorAll(".option-container div");
      const selectedMBTISpan = document.getElementById("selected-mbti");
      const selectedMBTIInput = document.getElementById("selected-mbti-input");
  
      radioGroups.forEach((group) => {
        const radios = group.querySelectorAll("input[type='radio']");
  
        radios.forEach((radio) => {
          radio.addEventListener("change", () => {
            checkSubmitButton(radioGroups);
            updateSelectedMBTI(radioGroups, selectedMBTISpan, selectedMBTIInput);
          });
        });
      });
    });

    function checkSubmitButton(radioGroups) {
    const submitButton = document.querySelector(".vote-submit-btn");
    let allSelected = true;

    radioGroups.forEach((group) => {
      const selected = group.querySelector("input[type='radio']:checked");
      if (!selected) {
        allSelected = false;
      }
    });

    submitButton.disabled = !allSelected;
  }

  function updateSelectedMBTI(radioGroups, selectedMBTISpan, selectedMBTIInput) {
    let selectedMBTI = "";

    radioGroups.forEach((group) => {
        const selected = group.querySelector("input[type='radio']:checked");
        if (selected) {
            selectedMBTI += selected.value;
        }
    });

    selectedMBTISpan.textContent = selectedMBTI;
    selectedMBTIInput.value = selectedMBTI; 
    console.log("Selected MBTI:", selectedMBTI);

    const submitButton = document.querySelector(".vote-submit-btn");
    submitButton.disabled = false;
  }
  </script>
    {% endblock %}
  </div>
</div>
