{% extends 'vote/base.html' %}
{% load static %}

{% block content %}
<div class="fortune-container">
    <p class="fortune-title">ğŸ¥  ì˜¤ëŠ˜ì˜ í¬ì¶˜ ì¿ í‚¤ ğŸ¥ </p>
    <img src="{% static 'img/Cookie.png' %}" style="width: 350px"/>
    <button id="fortune-modal-open">í¬ì¶˜ ì¿ í‚¤ ì—´ì–´ë³´ê¸°</button>
    <div class="fortune-modal">
        <div id="capture" class="fortune-modal-content">
          <span class="modal-close-icon" id="fortune-modal-close">&times;</span>
            <img class="modal-logo-pic" src="{% static 'img/Only_Text.png' %}" alt="logo">
            <img class="fortune-open-img" src="{% static 'img/slide/BrokenCookie.png' %}" alt="fortune-cookie-open">
            <div class="fortune-text">
              <span id="fortune-result typing-line2">
                {% if user.is_authenticated %}
                    <span class="fortune-reload"><span class="fortune-mbti">{{ user.mbti }}</span><span class="typing-text3"></span></span>
                {% else %}
                    <span class="fortune-reload"><span class="typing-text4"></span></span>
                {% endif %}
                </div>
          <div class="fortune-btns">
            <button id="capBtn" style="border: none">ìº¡ì²˜í•˜ê¸°</button> 
            <button id="fortune-retry">ë‹¤ì‹œë½‘ê¸°</button>
          </div>
          </div>
        </div>
    </div>
</div>
<script>
document.addEventListener("DOMContentLoaded", () => {
  function typeFortuneCookie(text, typingTextElement) {
    if (!typingTextElement) {
      return;
    }

    let charIndex = 0;
    const typingInterval = setInterval(() => {
      typingTextElement.textContent += text[charIndex];
      charIndex++;
      if (charIndex === text.length) {
        clearInterval(typingInterval);
      }
    }, 150);
  }

  const text3 = "ì¸ ë‹¹ì‹ ì€ " + "{{ random_fortune }}";
  const typingText3 = document.querySelector(".typing-text3");
  typeFortuneCookie(text3, typingText3);

  const text4 = "{{ random_fortune }}";
  const typingText4 = document.querySelector(".typing-text4");
  typeFortuneCookie(text4, typingText4);
});

</script>
<script>
document.addEventListener("DOMContentLoaded", () => {
  const modal = document.querySelector(".fortune-modal");
  const modalOpen = document.querySelector("#fortune-modal-open");
  const modalRetry = document.querySelector("#fortune-retry");
  const fortuneResult = document.querySelector("#fortune-result");
  const fortuneReload = document.querySelector('.fortune-reload')

  modalOpen.addEventListener("click", () => {
    modal.style.display = "block";
  });

  const modalClose = document.querySelector("#fortune-modal-close");
  modalClose.addEventListener("click", () => {
    modal.style.display = "none";
  });

  modalRetry.addEventListener("click", () => {
    if (fortuneResult) {
      fortuneResult.textContent = "í¬ì¶˜ ì¿ í‚¤ ë‹¤ì‹œ ë½‘ëŠ” ì¤‘...";
      setTimeout(() => {
        location.reload();
      }, 2000);
       // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
    }
    else {
    const retryMessageElement = document.createElement("p");
    retryMessageElement.textContent = "í¬ì¶˜ ì¿ í‚¤ ë‹¤ì‹œ ë½‘ëŠ” ì¤‘...";
    fortuneReload.classList.add("fortune-hidden");
    document.querySelector(".fortune-text").appendChild(retryMessageElement);

    setTimeout(() => {
      location.reload();
    }, 1500); // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
  }
});
});

</script>

<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
<script src="../../static/js/html2canvas.js"></script>
<script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
{% endblock %}
