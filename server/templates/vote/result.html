{% extends 'vote/base.html' %} {% load static %} {% block content %}

<section class="result-container">
  <div class="result-title">가정부 로봇 이야기</div>
    total_count : {{total_count}}
    </br>
    choice1_count : {{choice1_count}}
    </br>
    choice2_count : {{choice2_count}}
    </br>
    man_count : {{man_count}}
    </br>
    man_choice1_count : {{choice1_count}}
    </br>
    man_choice2_count : {{choice2_count}}
    </br>
    woman_count : {{woman_count}}
    </br>
    woman_choice1_count : {{woman_choice1_count}}
    </br>
    woman_choice2_count : {{woman_choice2_count}}
    </br>

    mbtis : 
    {% for item in mbtis %}
      {{ item }},
    {% endfor %}
    </br> 

    mbtis_count : 
    {% for item in mbtis_count %}
      {{ item }},
    {% endfor %}
    </br> 

    mbtis_choice1_count : 
    {% for item in mbtis_choice1_count %}
      {{ item }},
    {% endfor %}
    </br>

    mbtis_choice2_count :
    {% for item in mbtis_choice2_count %}
      {{ item }},
    {% endfor %}  
  <div class="graph-information">그래프 정보</div>
  <div class="graph-container">{% include 'vote/result/chart.html' %}</div>
  <button>공유하기</button>
  <div class="graph-category-container">카테고리 공간</div>
  <div class="comment-container">댓글 공간

    <form id="commentForm">
      {% csrf_token %}
      <input type="hidden" name="poll_id" value="{{ poll.id }}">
      <textarea class="replyContent" name="content" placeholder="댓글 내용"></textarea>
      <button type="submit" class="btnReply">댓글 작성</button>
  </form>
  
  <table class="replyTable">
      {% for comment in comments %}
      <tr>
          <td>{{ comment.user_info.nickname }}:: </td>
          <td>{{ comment.content }}</td>
          <td>올린 시간: {{ comment.created_at }}</td>
          <td>{{ comment.updated_at }}</td>
      </tr>
      {% endfor %}
  </table>


</div>

<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>
document.querySelector("#commentForm").addEventListener("submit", function(e) {
    e.preventDefault();

    let formData = new FormData(this);
    let pollId = "{{ poll.id }}"; 
    console.log(pollId);

    axios({
        method: 'post',
        url: `/${pollId}/reply/`,    // poll_id 파라미터를 전달하여 URL 생성
        data: formData
    })
    .then(response => {
        let data = response.data;
        
        let replyTable = document.querySelector(".replyTable");
        let newTr = document.createElement("tr");
        let str = `
            <td>${data.nickname}</td>
            <td>${data.content}</td>
            <td>${data.created_at}</td>
            <td>${data.updated_at}</td>`;
        newTr.innerHTML = str;
        replyTable.appendChild(newTr);

        document.querySelector(".replyContent").value = '';
    })
    .catch(error => {
        console.error("댓글 작성 중 오류가 발생했습니다.", error);
    });
});
</script>
</section>

{% endblock %}




