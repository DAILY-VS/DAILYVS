{% extends 'vote/base.html' %} {% load static %} {% block content %}
<section id="capture" class="result-container" data-color="pink">
  <div class="result-title">{{poll.title}}</div>
  <div class="result-graph-content">{{poll.content}}</div>
  <div class="graph-information-container">
    {% include 'vote/result/graph-information.html' %}
  </div>
  <div class="graph-container" data-color="skyblue">
    {% include 'vote/result/result-chart.html' %}
  </div>
  <div class="result-loading">
    <div class="spinner-border text-secondary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <div id="loading-text">당신의 성향 분석중..</div>
  </div>
 <div class="result-investigation typing-text" >
    <span class="typing-key">당신은</span>
    <span class="typing-bold">{{ minimum_key }}</span>
    <span class="typing-key">이지만</span>
    <span class="typing-value">0%</span>
    <span class="typing-key typing-effect"></span>  
</div>
  <button class="result-share-btn" id="copy-url-btn">
    공유하기<span
      ><img src="{% static 'img/icon/share.png'%}" style="width: 30px"
    /></span>
  </button>
  <div class="graph-category-container">
    <div>{% include 'vote/result/category-gender.html' %}</div>
    <div class="result-category-box">
      <div
        class="result-category-name"
        id="mbtiToggle"
        onclick="toggleRotation2()"
      >
        <img
          src="{% static 'img/icon/chevron_up.png'%}"
          style="width: 30px"
          class="chevron"
        />
        MBTI
      </div>
    </div>
    <div id="mbtiChart">
      <div class="panel" data-color="pink">
        {% include 'vote/result/category-EImbti.html' %}
      </div>
      <div class="panel" data-color="purple">
        {% include 'vote/result/category-SNmbti.html' %}
      </div>
      <div class="panel" data-color="skyblue">
        {% include 'vote/result/category-TFmbti.html' %}
      </div>
      <div class="panel" data-color="purple">
        {% include 'vote/result/category-PJmbti.html' %}
      </div>
    </div>
  </div>
  <div class="detail-like-container">{% include 'vote/result/like.html' %}</div>
  <div class="comment-container">{% include 'vote/result/comment.html' %}</div>
  <button id="capBtn" style="border: none">캡처하기</button>
</section>
<script src="{% static 'js/result.js' %}"></script>
<script>
  let isRotated2 = false;

  function toggleRotation2() {
    const chevron = document.querySelector(".chevron");
    if (isRotated2) {
      chevron.style.transform = "rotate(0deg)";
    } else {
      chevron.style.transform = "rotate(180deg)";
    }

    isRotated2 = !isRotated2;
  }
</script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.8/dist/clipboard.min.js"></script>
<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
<script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
<script src="{% static 'js/scroll.js' %}"></script>
<script src="../../static/js/html2canvas.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const mbtiToggle = document.getElementById("mbtiToggle");
    const mbtiChart = document.getElementById("mbtiChart");

    mbtiToggle.addEventListener("click", function () {
      mbtiChart.style.display =
        mbtiChart.style.display === "none" ? "block" : "none";
    });
  });

  //공유하기 버튼
  // 버튼 요소 가져오기
  const copyUrlBtn = document.getElementById("copy-url-btn");
  // 버튼을 클릭했을 때 이벤트 리스너 등록
  copyUrlBtn.addEventListener("click", () => {
    // 현재 페이지의 URL 가져오기
    const currentUrl = window.location.href;
    // 클립보드 복사 객체 생성
    const clipboard = new ClipboardJS(copyUrlBtn, {
      text: function () {
        return currentUrl; // 복사할 텍스트 설정
      },
    });
    // 클립보드 복사 성공 시 처리
    clipboard.on("success", () => {
      alert("URL이 복사되었습니다.");
      clipboard.destroy(); // 클립보드 객체 해제
    });
    // 클립보드 복사 실패 시 처리
    clipboard.on("error", () => {
      alert("URL 복사에 실패하였습니다.");
      clipboard.destroy(); // 클립보드 객체 해제
    });
    // 클릭 이벤트 트리거로 클립보드 복사 실행
    clipboard.onClick();
  });
</script>

<script>
const typingValueElement = document.querySelector('.typing-value');
const typingKeyElements = document.querySelectorAll('.typing-key');

let currentKeyIndex = 0;
let typingInProgress = false;

function typeNextWord(callback) {
  if (currentKeyIndex < typingKeyElements.length) {
    const currentKeyElement = typingKeyElements[currentKeyIndex];
    const word = currentKeyElement.textContent;
    currentKeyIndex++;

    let currentCharIndex = 0;
    const typingCharInterval = setInterval(() => {
      currentCharIndex++;
      const partialWord = word.slice(0, currentCharIndex);
      currentKeyElement.textContent = partialWord;

      if (currentCharIndex >= word.length) {
        clearInterval(typingCharInterval);
        setTimeout(() => {
          currentKeyElement.textContent = word;
          typeNextWord(callback);
        }, 500); // Delay before typing the next word
      }
    }, 100); // Typing speed for each character
  } else {
    callback(); 
  }
}

function startTypingEffect() {
  if (!typingInProgress) {
    typingInProgress = true;

    let currentValue = 0;
    const targetValue = {{minimum_value}};
    const step = targetValue / 60; // 총 40단계로 애니메이션 진행

    const typingInterval = setInterval(() => {
      currentValue += step;
      typingValueElement.textContent = `${currentValue.toFixed(1)}%`;

      if (currentValue >= targetValue) {
        clearInterval(typingInterval);
      }
    }, 90);
  }
}

typeNextWord(startTypingEffect); // Start the typing sequence with the callback

</script>
<script>
   document.addEventListener('DOMContentLoaded', function () {
            setTimeout(function () {
                var loadingicon = document.querySelector('.spinner-border');
                var loadingElement = document.querySelector('.result-loading');
                var loadingTextElement = document.getElementById('loading-text');
                 if (loadingTextElement) {
                    loadingTextElement.textContent = '분석완료!';
                    loadingicon.style.display = 'none';
                }
            }, 6500);
        });
</script>
{% endblock %}
