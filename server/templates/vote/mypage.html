{% extends 'vote/base.html' %}
{% load static %}
{% block content %}


<div class="mypage-container">
    <div class="mypage-prof-container">
        <img src='https://picsum.photos/100/100' alt="">
        <div class="mypage-info-wrap">
            <div class="mypage-nickname-wrap">
                <span class="mypage-blue">{{user.username}}&nbsp</span>
                <span id="mypage-gray" class="mypage-blue">님</span>
                <a href="{% url 'vote:update' %}" class="mypage-revise-btn">회원 수정</a>
            </div>
            <hr class="mypage-hr">
            <div class="mypage-prof-detail">
                <div class="mypage-nickname-wrap">
                    <span class="mypage-red">MBTI:</span>
                    <span class="mypage-blue">&nbsp&nbsp{{user.mbti}}</span>
                </div>
                <div class="mypage-nickname-wrap">
                    <span class="mypage-red">성별:</span>
                    <span class="mypage-blue">&nbsp&nbsp{{user.gender}}</span>
                </div>
            </div>
        </div>
    </div>
    <span>나의 VOTE LIST</span>
    <ul>
      {% for voted_poll in user.voted_polls.all %}
          <li>{{ voted_poll }}</li>
      {% endfor %}
    </ul>
    <div class="pagination-box">
        <div class="pagination">
            <a class="page-btn gray">
            <img src="{% static 'img/icon/left_page.png'%}" style="width: 30px" />
            </a>
    
        <br/>
        <a class="page-btn">
            {% comment %} <a class="page-btn gray"> {% endcomment %}
            {% for page in paginator.page_range %}
            <a class = "page-btn gray" href="?page={{ page}}">{{page}}</a>
            {% endfor %}
            {% comment %} </a> {% endcomment %}
            <img src="{% static 'img/icon/right_page.png'%}" style="width: 30px" />
            </a>
        </div>
    </div>
    <hr>

    <span>나의 stat gallery</span>
    <hr>
    <div class="stat-gallery">

    </div>
</div>


<!-- <div class="mypage-prof-detail"></div>
<input value={{user.username}} disabled>
<input value={{user.mbti}} disabled>
<input value={{user.gender}} disabled>
id: {{user.username}}
<br>
nickname: {{user.nickname}}
<br>
MBTI: {{user.mbti}}
<br>
성별: {{user.gender}}
<br>
{% if request.user == user %}
    <a href="{% url 'vote:update' %}">회원 수정</a>
    <a href="{% url 'account:change_password' %}">비밀번호 변경</a> 
    <a href="{% url 'account:delete' %}">회원 탈퇴</a>
{% endif %}

<h5>나의 vote list</h5>
{% for page in page_obj %}
    <span>{{page.title}}</span>
{% endfor %}

<div class="pagination-box">
    <div class="pagination">
      {% if page_obj.has_previous %}
      <a class="page-btn gray" href="?page={{ page_obj.previous_page_number }}">
        <img src="{% static 'img/icon/left_page.png' %}" style="width: 30px" />
      </a>
      {% endif %} {% for page_number in page_obj.paginator.page_range %}
      <a
        class="page-btn {% if page_number == page_obj.number %}red-pink{% endif %}"
        href="?page={{ page_number }}"
      >
        {{ page_number }}
      </a>
      {% endfor %} {% if page_obj.has_next %}
      <a class="page-btn gray" href="?page={{ page_obj.next_page_number }}">
        <img src="{% static 'img/icon/right_page.png' %}" style="width: 30px" />
      </a>
      {% endif %}
    </div>
  </div>
  {% endblock %}
</div>


<script>
    document.addEventListener("DOMContentLoaded", function () {
      const pollList = document.querySelector(".main-grid-content");
      const pagination = document.querySelector(".pagination");
  
      pagination.addEventListener("click", function (event) {
        if (event.target.tagName === "A") {
          event.preventDefault();
          const pageUrl = event.target.getAttribute("href");
  
          fetch(pageUrl)
            .then((response) => response.text())
            .then((data) => {
              const parser = new DOMParser();
              const newDoc = parser.parseFromString(data, "text/html");
  
              pollList.innerHTML =
                newDoc.querySelector(".main-grid-content").innerHTML;
              pagination.innerHTML =
                newDoc.querySelector(".pagination").innerHTML;
            })
            .catch((error) => console.error("Error fetching page:", error));
        }
      });
    });
  
    selectSort.addEventListener("change", function () {
    const sortValue = selectSort.value;
    const pageUrl = `{% url 'vote:main' %}?sort=${sortValue}`;
    updateContent(pageUrl);
  });
  
  </script>